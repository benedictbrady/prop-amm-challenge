[paths]
workspace = "."
strategy_file = "programs/starter/src/lib.rs"
baseline_strategy_file = "programs/starter/src/lib.rs"
state_dir = ".harness"
prompt_template = "harness/templates/default_prompt.md"

[loop]
max_iterations = 200
stop_on_target = true
agent_timeout_sec = 1800
task_timeout_sec = 1800
stagnation_window = 8
stagnation_min_delta = 2.0
diversification_interval = 5
restart_interval = 11
elite_pool_size = 6

[budget]
max_usd = 1000.0
fallback_per_iteration_usd = 5.0
fallback_on_failure_usd = 0.0

[agent]
# Use backend registry (preferred). Alternative: set `command_template = "..."`
backend = "codex_cli"
use_shell = true

[agent.backend_options]
model_expr = "$AGENT_MODEL"
fallback_model_expr = "$AGENT_MODEL"
reasoning_effort = "high"
sandbox = "danger-full-access"
dangerously_bypass_approvals_and_sandbox = true
skip_git_repo_check = false

[task]
command_template = "python3 harness/tasks/prop_amm/adapter.py --config harness/tasks/prop_amm/task.toml --action {action} --workspace {workspace} --strategy-file {strategy_file} --mode {mode} --iteration {iteration} --log-dir {iter_dir}/task"
use_shell = true

# Optional token pricing for tighter budget accounting.
# [pricing]
# input_per_million = 1.50
# cached_input_per_million = 0.375
# output_per_million = 6.00

# Optional periodic sysadmin check.
# [sysadmin]
# enabled = true
# interval_seconds = 600
# failure_streak_trigger = 0
# timeout_sec = 300
# prompt_template = "harness/templates/sysadmin_prompt.md"
# command_template = "python3 harness/agents/openai_sysadmin.py --prompt-file {prompt_file} --model $SYSADMIN_MODEL --fallback-model $SYSADMIN_MODEL --reasoning-effort high"
# use_shell = true
